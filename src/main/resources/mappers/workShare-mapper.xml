<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="workShareMapper">
	
	<!-- WorkShare -->
    <resultMap id="workShareResultSet" type="WorkShare">
       <id property="ws_no" column="WS_NO"/>
       <result property="ws_empno" column="WS_EMP_NO"/>
       <result property="ws_recv" column="WS_RECV"/>
       <result property="ws_ref" column="WS_REF"/>
       <result property="ws_sref" column="WS_SREF"/>
       <result property="ws_title" column="WS_TITLE"/>
       <result property="ws_content" column="WS_CONTENT"/>
       <result property="createDate" column="WS_CREATEDATE"/>
       <result property="editDate" column="WS_EDITDATE"/>
       <result property="ws_status" column="WS_STATUS"/>
       <result property="ws_recv_status" column="WS_RECV_STATUS"/>
       <result property="ws_reply" column="WS_REPLY"/>
       <result property="ws_favb" column="WS_FAVB"/>
       <result property="ws_senderName" column="EMP_NAME"/>
       <result property="ws_senderJobName" column="JOB_NAME"/>
    </resultMap>
	
	<!-- WSAttachment -->
	<resultMap id="wsAttachmentResultSet" type="WSAttachment">
		<id column="wsa_no" property="WSA_NO"/>
		<result column="wsa_empNo" property="WSA_EMP_NO"/>
		<result column="wsa_wsNo" property="WSA_WSNO"/>
		<result column="wsa_origin" property="WSA_ORIGIN"/>
		<result column="wsa_change" property="WSA_CHANGE"/>
		<result column="wsa_size" property="WSA_FILE_SIZE"/>
		<result column="wsa_status" property="WSA_STATUS"/>
	</resultMap>
	
	<!-- 업무공유 생성 -->
	<insert id="insertWorkShare" parameterType="WorkShare">
		INSERT INTO WORKSHARE
		VALUES(SEQ_WS.NEXTVAL, #{ws_empno}, #{ws_recv}, #{ws_ref}, #{ws_sref}, #{ws_title}, #{ws_content}, TO_CHAR(SYSDATE, 'YY/MM/DD HH24:MI:SS'), '', #{ws_status}, #{ws_recv}, #{ws_recv}, 'N')
	</insert>

	<!-- 업무공유 첨부파일 생성 -->
	<insert id="insertWSAttach" parameterType="WSAttachment">
		INSERT INTO WORKSHARE_ATTACHMENT
		VALUES(SEQ_WSA.NEXTVAL, #{wsa_empNo}, SEQ_WS.CURRVAL, #{wsa_origin}, #{wsa_change}, #{wsa_size}, #{wsa_status})
	</insert>
	
	<!-- 미확인 업무공유 개수 -->
	<select id="selectUncheckedWSListCount" resultType="_int">
		SELECT COUNT(*)
		FROM WORKSHARE A
		JOIN EMPLOYEE B ON B.EMP_NO = A.WS_EMP_NO
		JOIN DEPT C ON B.DEPT_CODE = C.DEPT_CODE
		JOIN JOB_LEVEL D ON D.JOB_CODE = B.JOB_CODE
		WHERE (WS_RECV LIKE '%'||#{empNo}||'%' OR WS_RECV LIKE '%'||#{deptCode}||'%')
		AND WS_STATUS = 'Y'
		AND WS_RECV_STATUS LIKE '%'||#{empNo}||'%'
	</select>
	
	<!-- 미확인 업무공유 목록 -->
	<select id="selectUnCheckedList" resultMap="workShareResultSet">
		SELECT A.WS_NO, A.WS_FAVB, B.EMP_NAME, A.WS_EMP_NO, A.WS_TITLE, A.WS_CREATEDATE, D.JOB_NAME
		FROM WORKSHARE A
		JOIN EMPLOYEE B ON B.EMP_NO = A.WS_EMP_NO
		JOIN DEPT C ON B.DEPT_CODE = C.DEPT_CODE
		JOIN JOB_LEVEL D ON D.JOB_CODE = B.JOB_CODE
		WHERE (WS_RECV LIKE '%'||#{empNo}||'%' OR WS_RECV LIKE '%'||#{deptCode}||'%')
		AND WS_STATUS = 'Y'
		AND WS_RECV_STATUS LIKE '%'||#{empNo}||'%'
		ORDER BY A.WS_NO DESC
	</select>

	<!-- 수신 업무공유 개수 -->
	<select id="selectRecvWSListCount" resultType="_int">
		SELECT COUNT(*)
		FROM WORKSHARE A
		JOIN EMPLOYEE B ON B.EMP_NO = A.WS_EMP_NO
		JOIN DEPT C ON B.DEPT_CODE = C.DEPT_CODE
		JOIN JOB_LEVEL D ON D.JOB_CODE = B.JOB_CODE
		WHERE (WS_RECV LIKE '%'||#{empNo}||'%' OR WS_RECV LIKE '%'||#{deptCode}||'%')
		AND WS_STATUS = 'Y'
	</select>
	
	<!-- 수신 업무공유 목록 -->
	<select id="selectRecvList" resultMap="workShareResultSet">
		SELECT A.WS_NO, A.WS_FAVB, B.EMP_NAME, A.WS_EMP_NO, A.WS_TITLE, A.WS_CREATEDATE, D.JOB_NAME
		FROM WORKSHARE A
		JOIN EMPLOYEE B ON B.EMP_NO = A.WS_EMP_NO
		JOIN DEPT C ON B.DEPT_CODE = C.DEPT_CODE
		JOIN JOB_LEVEL D ON D.JOB_CODE = B.JOB_CODE
		WHERE (WS_RECV LIKE '%'||#{empNo}||'%' OR WS_RECV LIKE '%'||#{deptCode}||'%')
		AND WS_STATUS = 'Y'
		ORDER BY A.WS_NO DESC
	</select>
	
	<!-- 발신 업무공유 개수 -->
	<select id="selectSendWSListCount" resultType="_int">
		SELECT COUNT(*)
		FROM WORKSHARE A
		JOIN EMPLOYEE B ON B.EMP_NO = A.WS_EMP_NO
		JOIN DEPT C ON B.DEPT_CODE = C.DEPT_CODE
		JOIN JOB_LEVEL D ON D.JOB_CODE = B.JOB_CODE
		WHERE A.WS_EMP_NO = #{empNo}
		AND WS_STATUS = 'Y'
	</select>

	<!-- 발신 업무공유 목록 -->
	<select id="selectSendList" resultMap="workShareResultSet">
		SELECT A.WS_NO, A.WS_FAVB, B.EMP_NAME, A.WS_RECV, A.WS_RECV_STATUS, A.WS_TITLE, A.WS_CREATEDATE, D.JOB_NAME
		FROM WORKSHARE A
		JOIN EMPLOYEE B ON B.EMP_NO = A.WS_EMP_NO
		JOIN DEPT C ON B.DEPT_CODE = C.DEPT_CODE
		JOIN JOB_LEVEL D ON D.JOB_CODE = B.JOB_CODE
		WHERE A.WS_EMP_NO = #{empNo}
		AND WS_STATUS = 'Y'
		ORDER BY A.WS_NO DESC
	</select>
	
	<!-- 임시저장 업무공유 개수 -->
	<select id="selectSavedWSListCount" resultType="_int">
		SELECT COUNT(*)
		FROM WORKSHARE A
		JOIN EMPLOYEE B ON B.EMP_NO = A.WS_EMP_NO
		JOIN DEPT C ON B.DEPT_CODE = C.DEPT_CODE
		JOIN JOB_LEVEL D ON D.JOB_CODE = B.JOB_CODE
		WHERE A.WS_EMP_NO = #{empNo}
		AND WS_STATUS = 'S'
	</select>
	
	<!-- 임시저장 업무공유 목록 -->
	<select id="selectSavedList" resultMap="workShareResultSet">
		SELECT A.WS_NO, A.WS_FAVB, B.EMP_NAME, A.WS_RECV, A.WS_RECV_STATUS, A.WS_TITLE, A.WS_CREATEDATE, D.JOB_NAME
		FROM WORKSHARE A
		JOIN EMPLOYEE B ON B.EMP_NO = A.WS_EMP_NO
		JOIN DEPT C ON B.DEPT_CODE = C.DEPT_CODE
		JOIN JOB_LEVEL D ON D.JOB_CODE = B.JOB_CODE
		WHERE A.WS_EMP_NO = #{empNo}
		AND WS_STATUS = 'S'
		ORDER BY A.WS_NO DESC
	</select>
	
	<!-- 업무공유 상세 조회 -->
	<select id="detailWS" parameterType="_int" resultMap="workShareResultSet">
		SELECT *
		FROM WORKSHARE
		WHERE WS_NO = #{wno}
		AND WS_STATUS = 'Y'
	</select>
	
	<!-- 업무공유 상세 조회 - 첨부파일 -->
	<select id="detailWSAttachment" parameterType="_int" resultMap="wsAttachmentResultSet">
		SELECT *
		FROM WORKSHARE_ATTACHMENT
		WHERE WSA_STATUS = 'Y'
		AND WSA_WSNO = #{wsno}
	</select>
</mapper>
